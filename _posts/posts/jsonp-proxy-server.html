---
uuid: "316833591574933552"
title: "JSONP Proxy Server"
date: "2009-03-10"
permalink: "/2009/03/jsonp-proxy-server.html"
description: 
categories: 
---

<div class="css-full-post-content js-full-post-content">
I was doing some JSON mashing the other day and wanted to use data from different web pages. <a href="http://en.wikipedia.org/wiki/XMLHttpRequest">XmlHttpRequest</a> was not an option, because I wanted to <a href="http://en.wikipedia.org/wiki/Cross-site_scripting">fetch content from different domains</a>.<br /><br />As many web pages don't provide an interface that returns <a href="http://bob.pythonmac.org/archives/2005/12/05/remote-json-jsonp/">JSONP</a>, I wrote a very simple proxy server in python that does just that. More specifically, the proxy forwards the incoming request to a hard coded url and returns the result wrapped into a callback function which is provided by the user.<script type="syntaxhighlighter" class="brush: python; gutter: false;"><![CDATA[<br />import urllib,re<br />from BaseHTTPServer import BaseHTTPRequestHandler, HTTPServer<br /><br />class RequestHandler(BaseHTTPRequestHandler):<br /><br />    def do_GET(self):<br />        query = re.search('.*(\?.*)', self.path).group(1)<br />        callback = re.search('.*callback=([^&amp;]*)', query).group(1)<br />        queryWithoutCallback = re.sub('[&amp;]?callback=[^&amp;]*', '', query);<br />        url = "http://funky.host.org/foo" + queryWithoutCallback;<br />   <br />        self.send_response(200)<br />        self.send_header('Content-type', 'text/html')<br />        self.end_headers()<br /> <br />        f = urllib.urlopen(url)<br />        response = f.read().strip()<br />        f.close()<br /><br />        self.wfile.write("%s(%s);" % (callback, response))<br />        return<br /><br />def main():<br />    try:<br />        server = HTTPServer(('', 80), RequestHandler)<br />        print '--- Server ready!'<br />        server.serve_forever()<br />    except KeyboardInterrupt:<br />        print '--- Shutting down...'<br />        server.socket.close()<br /><br />if __name__ == '__main__':<br />    main()<br />]]></script><br />Once the proxy is running, you can hit it with <a href="http://http//bob.pythonmac.org/archives/2005/12/05/remote-json-jsonp/">JSONP</a> requests:<script type="syntaxhighlighter" class="brush: javascript; gutter: false;"><![CDATA[<br />var script= document.createElement('script');<br />script.type= 'text/javascript';<br />script.src= 'http://localhost?foo=bar&amp;callback=foobar';<br />document.getElementsByTagName('head')[0].appendChild(script);<br /><br />function foobar(response) {<br />    // do something funky with response<br />}<br />]]></script>Or, if you prefer doing it in <a href="http://jquery.com/">JQuery</a>, which allows you to then handle the callback in a closure:<br /><script type="syntaxhighlighter" class="brush: javascript; gutter: false;"><![CDATA[<br />var url = 'http://localhost?foo=bar&amp;callback=?';<br />$.getJSON(url, function(response) {<br />    // do something funky with response<br />});<br />]]></script>
</div>
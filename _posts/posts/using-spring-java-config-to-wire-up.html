---
uuid: "1185391616346242799"
title: "Using Spring Java Config to wire up Dependencies"
date: "2010-04-11"
permalink: "/2010/04/using-spring-java-config-to-wire-up.html"
description: 
categories: 
---

<div class="css-full-post-content js-full-post-content">
The following tests demonstrate how, in <a target="_blank" href="http://www.springsource.org/javaconfig">Spring</a>, you can configure your beans explicitly using Java. I wasn't sure if the internal method calls would result in two instantiations of the dependency or not. Clearly, it works as expected, i.e. only one instance is created because the default mode for instantiating beans is singleton scope. The magic is called <a target="_blank" href="http://cglib.sourceforge.net/">cglib</a>.<br /><script type="syntaxhighlighter" class="brush: java;"><![CDATA[<br />public class ConfigTest {<br /><br />    @Test<br />    public void shouldUseSingleInstanceEvenIfCreatedUsingMethodCall() {<br />        ApplicationContext ctx = createContext(MethodConfig.class);<br />        assertThat(ctx.getBean(Foo.class).dependency, sameInstance(ctx.getBean(Bar.class).dependency));<br />    }<br /><br />    @Test<br />    public void shouldUseSingleInstanceIfAutowired() {<br />        ApplicationContext ctx = createContext(AutowiredConfig.class);<br />        assertThat(ctx.getBean(Dependency.class), sameInstance(ctx.getBean(Baz.class).dependency));<br />    }<br /><br />    private ApplicationContext createContext(Class<?> config) {<br />        AnnotationConfigApplicationContext ctx = new AnnotationConfigApplicationContext();<br />        ctx.register(config);<br />        ctx.refresh();<br />        return ctx;<br />    }<br />}<br />]]></script><br /><script type="syntaxhighlighter" class="brush: java;"><![CDATA[<br />@Configuration<br />public class MethodConfig {<br /><br />    @Bean<br />    public Foo foo() {<br />        return new Foo(dependency());<br />    }<br /><br />    @Bean<br />    public Bar bar() {<br />        return new Bar(dependency());<br />    }<br /><br />    @Bean<br />    public Dependency dependency() {<br />        return new Dependency();<br />    }<br />}<br />]]></script><br /><script type="syntaxhighlighter" class="brush: java"><![CDATA[<br />@Configuration<br />@Import(MethodConfig.class)<br />public class AutowiredConfig {<br /><br />    @Autowired<br />    private Dependency dependency;<br /><br />    @Bean<br />    public Baz baz() {<br />        return new Baz(dependency);<br />    }<br />}<br />]]></script><br /><script type="syntaxhighlighter" class="brush: java;"><![CDATA[<br />public class Foo {<br />    public final Dependency dependency;<br /><br />    public Foo(Dependency dependency) {<br />        this.dependency = dependency;<br />    }<br />}<br />]]></script><br /><script type="syntaxhighlighter" class="brush: java;"><![CDATA[<br />public class Bar {<br />    public final Dependency dependency;<br /><br />    public Bar(Dependency dependency) {<br />        this.dependency = dependency;<br />    }<br />}<br />]]></script><br /><script type="syntaxhighlighter" class="brush: java;"><![CDATA[<br />public class Baz {<br />    public final Dependency dependency;<br /><br />    public Baz(Dependency dependency) {<br />        this.dependency = dependency;<br />    }<br />}<br />]]></script><br /><script type="syntaxhighlighter" class="brush: java;"><![CDATA[<br />public class Dependency {}<br />]]></script>
</div>
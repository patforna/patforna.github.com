---
layout: post
title: Declarative Replacement of Annotation-Driven Bean Definitions in Spring
date: 2010-04-11
comments: false
---

<h1>{{ page.title }}</h1>
<div class='post'>
If you are using <a target="_blank" href="http://www.springsource.org/">Spring 3</a> and configure your dependencies explicitly in a <span style="font-family: courier new;font-size:85%;" >@Configuration</span> class, it's fairly easy to replace one dependency with another. All you need to do is declare two dependencies with the same bean name in two separate config classes. The beans of the config which is registered last to the <span style="font-size:85%;"><span style="font-family: courier new;">ApplicationContext</span></span>, will simply override the beans defined in previously registered config classes.<br /><br />Things get a bit more tricky, however, when you try to override a bean that has been wired up automatically using annotations. In this case, simply registering a config class that contains a bean with the same name as the annotated dependency doesn't yield the desired effect. It's very well possible that using a <span style="font-size:85%;"><span style="font-family: courier new;"> JavaConfigApplicationContext</span></span> might solve the issue but while <a target="_blank" href="http://www.springsource.org/javaconfig">JavaConfig</a> integration with the latest <a target="_blank" href="http://www.springsource.org/">Spring 3</a> <a target="_blank" href="http://jira.springframework.org/browse/SJC-231">is flakey</a>, this seems not an option. In the meantime, here's an example that demonstrates a solution to achieve the desired behaviour:<br /><script type="syntaxhighlighter" class="brush: java;"><![CDATA[<br />@Test<br />public void shouldReplaceBean() {<br />    AnnotationConfigApplicationContext parent = new AnnotationConfigApplicationContext();<br />    parent.register(Square.class); // the annotated class<br />    parent.refresh();<br /><br />    AnnotationConfigApplicationContext ctx = new AnnotationConfigApplicationContext();<br />    ctx.setParent(parent); // bean definitions in child ctx will have precedence<br />    ctx.register(ShapeConfig.class); // the config that will replace the Square bean<br />    ctx.refresh();<br /><br />    assertThat(ctx.getBean(Shape.class), instanceOf(Circle.class));<br />}<br />]]></script><br /><script type="syntaxhighlighter" class="brush: java;"><![CDATA[<br />public interface Shape {}<br />]]></script><br /><script type="syntaxhighlighter" class="brush: java;"><![CDATA[<br />@Component("shape") // an auto-detected 'shape' bean<br />public class Square implements Shape {}<br />]]></script><br /><script type="syntaxhighlighter" class="brush: java;"><![CDATA[<br />@Configuration<br />public class ShapeConfig {<br />    @Bean<br />    public Shape shape() { // will replace the 'shape' bean<br />        return new Circle();<br />    }<br />}<br />]]></script><br /><script type="syntaxhighlighter" class="brush: java;"><![CDATA[<br />public class Circle implements Shape {}<br />]]></script></div>
<h2>Comments</h2>
<div class='comments'>
</div>
